%%% CCNU BEAMER THEME %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                           %
% HOW TO USE                                                                %
%                                                                           %
% After loading beamer document class with:                                 %
%   \documentclass{beamer}                                                  %
% Just load the theme in your preamble:                                     %
%   \usetheme[options]{themename}                                           %
%                                                                           %
% Available options are:                                                    %
% - numbering:  shows slide numbers at the right-bottom corner of slide.    %
% - progress:   shows a nice progressbar under the section titles.          %
% - transition: force a transition slide every new \section{} command. Note %
%               that \section*{} will not have a transition slide (and it   %
%               will not appear on the table of contents.                   %
%                                                                           %
% Commands defined in this theme:                                           %
% - \logoframe              Frame with logo centered.                       %
% - \titleframe             Title frame.                                    %
% - \tocframe{title}        Table of Contents frame with given title.       %
% - \transitionframe{text}  Transition frame with given text.               %
%                                                                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Defining the preamble
\RequirePackage{varwidth}
\RequirePackage{appendixnumberbeamer}
\newif\if@transition
\@transitionfalse
\DeclareOption{transition}{\@transitiontrue}
\newif\if@numbering
\@numberingfalse
\DeclareOption{numbering}{\@numberingtrue}
\newif\if@progressbar
\@progressbarfalse
\DeclareOption{progress}{\@progressbartrue}
\ProcessOptions

%%% Some useful commands

% Remove numbers from frames:
%  \nonumbering{\frame{...}} or \nonumbering{\begin{frame}...\end{frame}}
\newcommand\nonumbering[1]{\if@numbering\@numberingfalse#1\@numberingtrue\else#1\fi}

% Adds a transition frame called “Backup” and resets sections after \appendix
\newif\if@notappendix
\@notappendixtrue
\g@addto@macro{\appendix}{
  \@numberingfalse
  \@notappendixfalse
  \section*{}
  \subsection*{Backup}
  \transitionframe{Backup}
}

%%% Theme definition
\mode<all> {
    \usepackage{calc}

    % Font theme %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \usefonttheme{professionalfonts}

    \setbeamerfont{title}{series=\bfseries,size=\huge}
    \setbeamerfont{subtitle}{series=\bfseries,size=\Large}
    \setbeamerfont{author}{size=\normalsize}
    \setbeamerfont{institute}{size=\small}
    \setbeamerfont{date}{size=\tiny}
    \setbeamerfont{headline section}{series=\bfseries,size=\tiny}
    \setbeamerfont{headline subsection}{series=\bfseries,size=\Large}
    \setbeamerfont{footline}{size=\tiny}

    \setbeamerfont{frametitle}{series=\bfseries}
    \setbeamerfont{block title}{series=\bfseries}
    \setbeamerfont{item projected}{family=\lfstyle,series=\bfseries}

    % Color theme %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % colors
    \newcommand\logoimg{ccnu_logo}
    \newcommand\fulllogoimg{ccnu_full_logo}
    \definecolor{00}{HTML}{FFFFFF} % white
    \definecolor{01}{HTML}{4D4D4D} % gray
    \definecolor{02}{HTML}{005768} % blue
    \definecolor{A0}{HTML}{202020} % black/dark gray
    \definecolor{A1}{HTML}{262626}
    \definecolor{A2}{HTML}{393939}
    \definecolor{B0}{HTML}{003039} % blue
    \definecolor{B1}{HTML}{00404C}
    \definecolor{B2}{HTML}{004856}
    \definecolor{C0}{HTML}{DC493A} % sand
    \definecolor{C1}{HTML}{E88B81}
    \definecolor{C2}{HTML}{F5CDC9}
    \definecolor{D0}{HTML}{8C8C8C} % light gray
    \definecolor{D1}{HTML}{BABABA}
    \definecolor{D2}{HTML}{E8E8E8}

    % titlepage
    \setbeamercolor{title}{fg=00,bg=02}

    % body
    \setbeamercolor{normal text}{fg=01,bg=00}
    \setbeamercolor{background}{fg=02,bg=00}
    \setbeamercolor{alerted text}{fg=02,bg=00}

    % table of contents
    \setbeamercolor{section in toc}{fg=02}
    \setbeamercolor{subsection in toc}{fg=B1}
    \setbeamercolor{subsubsection in toc}{fg=A2}

    % header/footer
    \setbeamercolor{headline}{fg=00,bg=02}
    \setbeamercolor{footline}{fg=D2,bg=A0}
    \setbeamercolor{frametitle}{fg=00,bg=02}

    % blocks
    \setbeamercolor{block title}{fg=00,bg=02}
    \setbeamercolor{block body}{fg=01,bg=D2}
    \setbeamercolor{block title alerted}{fg=D2,bg=B0}
    \setbeamercolor{block body alerted}{fg=00,bg=02}
    \setbeamercolor{block title example}{fg=00,bg=02}
    \setbeamercolor{block body example}{fg=01,bg=C1}

    % lists
    \setbeamercolor{item}{fg=02}
    \setbeamercolor{subitem}{fg=B1}
    \setbeamercolor{subsubitem}{fg=A2}
    \setbeamercolor{item projected}{bg=02}
    \setbeamercolor{subitem projected}{bg=B1}
    \setbeamercolor{subsubitem projected}{bg=A2}
    \setbeamercolor{enumerate item}{fg=02}
    \setbeamercolor{enumerate subitem}{fg=B1}
    \setbeamercolor{enumerate subsubitem}{fg=A2}
    \setbeamercolor{description item}{fg=02}

    % Inner theme %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \setbeamertemplate{itemize items}{\raisebox{-1.25pt}{\LARGE$\bullet$}}
    \setbeamertemplate{enumerate items}[circle]
    \setbeamertemplate{blocks}[rounded][shadow=true]

    % Outer theme %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    % Navigation symbols
    \setbeamertemplate{navigation symbols}{}

    % Background
    \setbeamertemplate{background canvas}{\usebeamercolor[bg]{background}\rule{\paperwidth}{\paperheight}}
    \setbeamertemplate{background}[default]

    % Logo frame
    \newcommand\logoframe{{%
        \setbeamertemplate{background}{\usebeamercolor[fg]{background}\rule{\paperwidth}{\paperheight}}
        \frame[noframenumbering, plain]{\centering\includegraphics[keepaspectratio, width=\textwidth, height=\textheight]{\logoimg}}
    }}

    % Title frame
    \newcommand\titleframe{{%
        \setbeamertemplate{background}{\usebeamercolor[fg]{background}\rule{\paperwidth}{0.5\paperheight}}
        \frame[noframenumbering, plain]{\titlepage}
    }}

    % Title page template
    \setbeamertemplate{title page}{%
        \begin{minipage}[t][0.43\paperheight][b]{\textwidth}
            \centering\usebeamercolor[bg]{background}
            \includegraphics[height=26pt]{\fulllogoimg}
            \\\vspace*{-1em}
            {\tiny Institute of Particle Physics}
            \vfill
            \raggedright\usebeamerfont*{title}\usebeamercolor[fg]{title}
            \inserttitle
        \end{minipage}
        \\\vfill
        \begin{minipage}[b][0.43\paperheight][t]{\textwidth}
            \centering\usebeamercolor[fg]{normal text}
            \usebeamerfont*{subtitle}\insertsubtitle
            \vfill
            \vfill
            \usebeamerfont*{author}\insertauthor
            \vfill
            \usebeamerfont*{institute}\insertinstitute
            \vfill
            \vfill
            \usebeamerfont*{date}\insertdate
        \end{minipage}
    }

    % Transition frame
    \newcommand\transitionframe[1]{{%
        \setbeamertemplate{background}{\usebeamercolor[fg]{background}\rule{\paperwidth}{0.5\paperheight}}
        \frame[noframenumbering, plain]{%
            \begin{minipage}[t][0.43\paperheight][b]{\textwidth}
                \raggedright\usebeamerfont*{title}\usebeamercolor[fg]{title}#1
            \end{minipage}
            \\\vfill\vspace*{0.43\paperheight}
        }
    }}
    \if@transition\AtBeginSection[]{\transitionframe{\insertsectionhead}}\fi

    % Summary frame
    \newcommand\tocframe[1][Outline]{{%
        \section*{}
        \subsection*{#1}
        \nonumbering{\frame[noframenumbering]{\tableofcontents}}
    }}

    % Headline
    \setbeamertemplate{headline}{%
        \begin{beamercolorbox}[wd=\paperwidth,ht=30pt]{headline}
        \hspace*{1em}
        \begin{minipage}[b][30pt][c]{0.7\textwidth}
            {\usebeamerfont*{headline section}\insertsection}
            \vspace*{1ex}

            {\usebeamerfont*{headline subsection}\insertsubsection}
        \end{minipage}\hspace*{1em}
        \hfill
        \begin{varwidth}[b][30pt][c]{0.2\textwidth}
            \includegraphics[height=0.8\headheight]{\logoimg}
        \end{varwidth}
        \hspace*{1em}
        \end{beamercolorbox}

        % Progress bar
        \if@progressbar
            \newdimen\barlength
            \barlength=\paperwidth
            \divide\barlength by 100 % workaround overflow if 16:9 aspect is selected
            \if@notappendix
                \multiply\barlength by \insertframenumber
                \divide\barlength by \inserttotalframenumber
            \fi
            \multiply\barlength by 100
            \usebeamercolor[fg]{normal text}\rule{\barlength}{2pt}
        \fi
    }

    % Footline
    \setbeamertemplate{footline}{%
        \begin{beamercolorbox}[wd=\paperwidth,ht=2.8ex]{footline}%
        \begin{minipage}[c][2.4ex][t]{0.2\paperwidth}
            \hfill\insertshortauthor\hspace*{1ex}
        \end{minipage}%
        \begin{minipage}[c][2.4ex][t]{0.6\paperwidth}
            \centering\insertshorttitle
        \end{minipage}%
        \begin{minipage}[c][2.4ex][t]{0.2\paperwidth}
            \hspace*{1ex}\insertshortdate\hfill%
            \if@numbering{\insertframenumber\,/\,\inserttotalframenumber\hspace*{1ex}}\fi%
        \end{minipage}%
        \end{beamercolorbox}
    }
}
