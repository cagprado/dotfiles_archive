#!/bin/zsh

autoload +X parse_cmdline help setmonitors

local USAGE="%Busage:%b $0"
local DESC="Watches monitor connections and call setmonitors."

local HELP=false
local SUMMARY=false
if ! parse_cmdline 'h|help|long-help>HELP H|short-help|summary>SUMMARY' $@; then
  print -P "$USAGE"
  return 1
fi
help $HELP $SUMMARY $0 $USAGE $DESC && return

udevadm monitor -k -s drm | grep --line-buffered change | while read; do
  setmonitors
done
