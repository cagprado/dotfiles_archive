#!/bin/zsh

autoload +X parse_cmdline help setmonitors

local USAGE="%Busage:%b $0"
local DESC="Lock the screen."
local HELP=false
local SUMMARY=false
if ! parse_cmdline 'h|help|long-help>HELP H|short-help|summary>SUMMARY' $@; then
  print -P "$USAGE"
  return 1
fi
help $HELP $SUMMARY $0 $USAGE $DESC && return

# Prepare
xset s dpms 5
setmonitors -x

# Run locker
sflock
SFLOCK_PID=$(pidof sflock)
while [[ -e /proc/$SFLOCK_PID ]]; do sleep 0.1; done

# Finish
xset s off -dpms
setmonitors
