#!/bin/zsh

autoload +X parse_cmdline help

local USAGE="%Busage:%b $0 escape"
local DESC="Wraps escape sequence for Tmux passthrough."
local HELP=false
local SUMMARY=false
local escape=''
if ! parse_cmdline '.escape h|help|long-help>HELP H|shor-help|summary>SUMMARY' $@; then
  print -P "$USAGE"
  return 1
fi
help $HELP $SUMMARY $0 $USAGE $DESC && return

if [[ -n "$TMUX" ]]; then
  escape=${escape//\\e/\\e\\e}
  escape=${escape//\\033/\\033\\033}
  escape=${escape//\\x1b/\\x1b\\x1b}
  escape=${escape//\\x1B/\\x1B\\x1B}
  escape=${escape///}
  echo -E "\ePtmux;${escape}\e\\"
else
  echo -E $escape
fi
