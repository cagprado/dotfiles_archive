#!/bin/zsh

# CONFIGURATION #############################################################
local large_size=22
local small_size=7
#############################################################################

autoload +X parse_cmdline help err tmux_wrap_esc

local USAGE="%Busage:%b $0 [size]"
local DESC="Set konsole font size."
local LONGHELP
LONGHELP=$(<<END
If called without argument defaults to normal font size defined in
Default.profile. Arguments may be one of %Unormal%u, %Ularge%u or %Usmall%u,
and is case insensitive.
END
)

local HELP=false
local SUMMARY=false
if ! parse_cmdline '=size h|help|long-help>HELP H|short-help|summary>SUMMARY' $@; then
  print -P "$USAGE"
  return 1
fi
help $HELP $SUMMARY $0 $USAGE $DESC $LONGHELP && return

if [[ ! "$TERM" =~ "tmux" && ! "$TERM" =~ "konsole" ]]; then
  err "This script is only for konsole terminal..."
  return 1
fi
local konsole_profile=$HOME/.local/share/konsole/Default.profile
local font_setting=$(grep '^Font=' $konsole_profile)
local size=''

case $size in
  large|LARGE)
    local escape="\e]50;${(S)font_setting/,*,/,${large_size},}\007"
    ;;
  small|SMALL)
    local escape="\e]50;${(S)font_setting/,*,/,${small_size},}\007"
    ;;
  normal|NORMAL|'')
    local escape="\e]50;${font_setting}\007"
    ;;
  *)
    err "Unknown font size."
    print -P "$USAGE"
    return 1
    ;;
esac

echo -ne $(tmux_wrap_esc $escape) && sleep 0.1 || :
