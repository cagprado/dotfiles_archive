#!/bin/sh

opt='--all --color --graph'
fmt='â™«%C(4 bold)%h%C(r)â€¿%sâ€¿%C(5 bold)%cr%C(r)â™«%C(auto)â™«%Dâ™«%C(r)'
fil=$(cat <<-'__END__'
	function graph(s) {
	  gsub("[^ *|/\\\\]", "",    s)
	  gsub("[|]\\\\",     "â”œâ”€â•®", s)
	  gsub("[|]/",        "â”œâ”€â•¯", s)
	  gsub("[|]",         "â”‚",   s)
	  gsub("[*]",         "â”œ",   s)
	  return "[31m" s "[m"
	}
	{
	  $1 = graph($1)
	  if ($4 == "") {
	    print $1 $2
	  } else {
	    $4 = $1 "â€¿" $3 $4 $5
	    gsub(" â”œ", "", $4)
	    gsub("â”œ", NR==1 ? "" : "â”‚", $4)
	    print $4 "\n" $1 $2
	  }
	}
	__END__
)

git log $opt --pretty="$fmt" | awk -Fâ™« "$fil" | column -tsâ€¿ | less
